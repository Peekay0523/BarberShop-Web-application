{% extends 'base.html' %}

{% load static %}

<style>
.client-list-container {
    overflow-x: auto;
    max-width: 100%;
    display: block;
    width: 100%;
}

.client-list-container table {
    width: 100%;
    min-width: 600px; /* Minimum width to prevent content from getting too compressed */
    table-layout: auto; /* Allow the table to size content naturally */
}

/* Ensure table headers and cells are properly sized */
.client-list-container th,
.client-list-container td {
    white-space: nowrap;
    padding: 0.75rem;
}

/* Ensure the card body fits the table properly */
.card-body {
    overflow: visible;
}
</style>

{% block content %}
<!-- Navigation -->
    <div class="header">
        <img src="{% static 'images/Header BG-Desktop.jpg' %}" alt="Barber Shop">
        
        <div class="my-navbar">
            <div class="subMenu">
                <ul>
                    <li><a href="#">Home</a></li>
                    <li><a href="#CutPrices">Manage Prices</a></li>
                    <button id="open-profile" class="btn btn-primary" style="background-color: transparent; border: none;">
                        <li>Manage Contact</li>
                    </button>
                    
                    {% if user.is_authenticated %}
                    
                        <li><a href="{% url 'logout' %}">Logout</a></li>
                    {% else %}
                        <li><a href="{% url 'login_page' %}">Login</a></li>
                    
                    {% endif %}
                </ul>
            </div>
        </div>

        <div class="header-message">
            <p>Admin dashboard</p>
            <p>Manage your barber shop clients and appointments</p>
        </div>
        <div class="logo">
            <img src="{% static 'images/LOgo.png' %}" alt="Logo">
        </div>
    </div>



<!-- Main Content -->
<div class="container-fluid px-5 my-5">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="text-dark">Client Management</h2>
                
            </div>
            
            <div class="card">
                <div class="card-body p-0">
                    <div class="client-list-container">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th scope="col">ID</th>
                                    <th scope="col">Name</th>
                                    <th scope="col">Surname</th>
                                    <th scope="col">Haircut</th>
                                    <th scope="col">Amount Paid</th>
                                    <th scope="col">Appointment Date</th>
                                    <th scope="col">Created Date</th>
                                    <th scope="col">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for client in clients %}
                                <tr>
                                    <td class="align-middle">{{ client.id }}</td>
                                    <td class="align-middle">{{ client.name }}</td>
                                    <td class="align-middle">{{ client.surname }}</td>
                                    <td class="align-middle">{{ client.haircut }}</td>
                                    <td class="align-middle">R{{ client.amount_paid }}</td>
                                    <td class="align-middle">{{ client.appointment_date|date:"Y-m-d H:i" }}</td>
                                    <td class="align-middle">{{ client.created_date|date:"Y-m-d H:i" }}</td>
                                    <td class="align-middle">
                                        <form method="post" action="{% url 'delete_client' %}" style="display:inline;">
                                            {% csrf_token %}
                                            <input type="hidden" name="cus_id" value="{{ client.id }}">
                                            <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Are you sure you want to delete this client?')">Delete</button>
                                        </form>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="8" class="text-center py-4">No clients found</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Footer -->
<footer class="footer bg-light mt-5 py-4">
    <div class="container">
        
        <hr class="my-3">
        <div class="text-center">
            <p class="text-muted mb-0">&copy; 2025 Clean|CUT Barber Shop. All rights reserved.</p>
        </div>
    </div>
</footer>

<script>
    // Add confirmation for delete actions
    document.querySelectorAll('form[method="post"]').forEach(form => {
        form.addEventListener('submit', function(e) {
            if (!confirm('Are you sure you want to delete this client?')) {
                e.preventDefault();
            }
        });
    });
</script>
{% endblock %}